{% extends "lista.html" %}
{% load humanize %}

{% block title %}Eventos{% endblock %}

{% block filtros %}
  <div class="filter-container">
    <form method="get">
      <label for="fecha_desde">Desde:</label>
      <input type="date" name="fecha_desde" id="fecha_desde" value="{{ fecha_desde }}"
             />
      <label for="fecha_hasta">Hasta:</label>
      <input type="date" name="fecha_hasta" id="fecha_hasta" value="{{ fecha_hasta }}"
             />
      <button type="submit" class="btn-filter">Filtrar</button>
    <a href="{% url 'eventos_lista' %}" class="btn-filter">Limpiar</a>
    </form>
    {% if not is_agente %}
      <a href="{% url 'agregar_evento' %}?next={{ request.get_full_path|urlencode }}" class="btn-primary">Nuevo evento</a>
    {% endif %}
  </div>
{% endblock %}

{% block tabla_head %}
  <tr>
    <th>Cliente</th>
    <th>Nombre</th>
    <th>Teléfono</th>
    <th>Ticket</th>
    <th>Fecha registro</th>
    <th>Acciones</th>
  </tr>
{% endblock %}

{% block tabla_body %}
  {% for e in eventos %}
    <tr>
      <td>{{ e.cliente.get_full_name|default:e.cliente.username }}</td>
      <td>{{ e.nombre }}</td>
      <td>{{ e.telefono }}</td>
      <td>$ {{ e.ticket|floatformat:2|intcomma }}</td>
      <td>{{ e.fecha_registro|date:"d/m/Y H:i" }}</td>
      <td>
        <a href="{% url 'editar_evento' e.id %}?next={{ request.get_full_path|urlencode }}" class="btn-detalle">Detalle</a>
        {% if is_agente %}
          <a href="{% url 'eventos_encuesta' e.id %}?next={{ request.get_full_path|urlencode }}" class="btn-detalle">Encuesta</a>
          <input type="checkbox" disabled title="Tiene respuestas"
                 style="vertical-align:middle; margin-left:.25rem;"
                 {% if e.encuesta and e.encuesta.respuestas.all %}checked{% endif %} />
        {% endif %}
      </td>
    </tr>
  {% empty %}
    <tr>
      <td colspan="100%">Sin eventos registrados</td>
    </tr>
  {% endfor %}
{% endblock %}




